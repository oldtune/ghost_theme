import{u as Y,aP as A,r as h,j as e,B as P,aQ as V,ai as C,aR as D,aS as J,ab as re,aj as f,aT as F,aU as ie,aV as le,af as oe,ag as U,aW as ne,S as q}from"./index-Bgo4hw-T.js";import{u as ce,c as de,D as me}from"./growth-BUQvBEMA.js";import{K as L,a as S,b as _,c as T}from"./kpi-card-CaX6eHyr.js";import{C as E,a as K,b as O,c as y,K as R,d as I,e as M,u as Q}from"./pagemenu-D3ByoZIR.js";import{D as pe,a as he,b as xe,c as ue,d as ge,e as je,f as fe,g as ve}from"./data-list-6rXP5AUF.js";import{u as be,p as Ne,N as ye,c as we}from"./links-lZnz9cuZ.js";import{M as ke}from"./wallet-cards-Cl4bJBBw.js";import{P as Ce,a as Le}from"./post-analytics-header-CpBVLNat.js";import{S as Se,K as _e}from"./kpis-BfR_uoFr.js";import{E as Te}from"./empty-indicator-CzTRebSi.js";import{G as De}from"./gh-chart-ldqA2tQU.js";import{u as X,S as Re}from"./post-analytics-context-BQ8IcW4n.js";import{h as Ie,i as Me}from"./post-helpers-gInwAwEv.js";import{S as Ae}from"./sprout-CXg43Zav.js";import"./source-icon-BDparw9V.js";import"./source-utils-B1S3ZHA2.js";import"./table-BWAnP2ln.js";import"./currency-fEUUCkj0.js";import"./stats-B2vPCVx7.js";import"./chart-0ezwQhyB.js";import"./_baseAssignValue-D0bBhNG1.js";import"./PolarAngleAxis-BzbazaED.js";import"./post-share-modal-Dz4BNSV-.js";import"./posts-C94RiQ4S.js";import"./trash-BKeiM6WP.js";import"./lucide-react-7D_Tsesk.js";import"./a-large-small-gBDqOWOy.js";import"./at-sign-V79EBNTJ.js";import"./message-square-text-DzuHB7uU.js";import"./copy-CTHgI4YI.js";import"./hash-CRtHv162.js";import"./inbox-DWYGFLuU.js";import"./list-filter-CofVbkA4.js";import"./minus-BIdO1CDG.js";import"./tags-BQz2NtFF.js";import"./square-C8G-1gV_.js";import"./user-round-check-Df7ko4Tm.js";import"./repeat-YTCeIlQZ.js";import"./reply-CUazFbTY.js";import"./tabs-Bw13eFRh.js";import"./index-D0RISNEd.js";const Pe=({post:o,isNewsletterStatsLoading:c,isWebShown:x})=>{const{postId:s}=Y(),a=A(),t=h.useMemo(()=>{const l=o.email?.opened_count||0,r=o.email?.email_count||0,p=o.count?.clicks||0;return{opened:l,clicked:p,openedRate:r>0?l/r:0,clickedRate:r>0?p/r:0,sent:r}},[o]),{data:m}=be({searchParams:{filter:`post_id:'${s}'`}}),u=h.useMemo(()=>Ne(m),[m]),g=[{datatype:"Clicked",value:t.clickedRate,fill:"url(#gradientTeal)",color:"hsl(var(--chart-teal))"},{datatype:"Opened",value:t.openedRate,fill:"url(#gradientBlue)",color:"hsl(var(--chart-blue))"}],n={percentage:{label:"Opened"},Average:{label:"Clicked"},"This newsletter":{label:"Opened"}},i=o.email_only||!x;return e.jsxs(E,{className:`group/datalist overflow-hidden ${i&&"col-span-2"}`,children:[e.jsxs("div",{className:"relative flex items-center justify-between gap-6",children:[e.jsx(K,{children:e.jsxs(O,{className:"flex items-center gap-1.5 text-lg",children:[e.jsx(ke,{size:16,strokeWidth:1.5}),"Newsletter performance"]})}),e.jsx(P,{className:"absolute right-6 translate-x-10 opacity-0 transition-all duration-300 group-hover/datalist:translate-x-0 group-hover/datalist:opacity-100",size:"sm",variant:"outline",onClick:()=>{a(`/posts/analytics/${s}/newsletter`)},children:"View more"})]}),c?e.jsx(y,{children:e.jsx("div",{className:"mx-auto flex min-h-[250px] items-center justify-center xl:size-full",children:e.jsx(V,{})})}):e.jsxs(y,{className:`${i&&"grid grid-cols-2"}`,children:[e.jsxs("div",{className:`${i&&"border-r pr-6"}`,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(R,{className:"group relative flex grow flex-row items-start justify-between gap-5 border-none px-0 pt-0",children:e.jsxs("div",{className:"flex grow flex-col gap-1.5 border-none pb-0",children:[e.jsx(I,{color:"hsl(var(--chart-blue))",children:"Open rate"}),e.jsx(M,{value:C(t.openedRate)})]})}),e.jsx(R,{className:"group relative flex grow flex-row items-start justify-between gap-5 border-none px-0 pt-0",children:e.jsxs("div",{className:"flex grow flex-col gap-1.5 border-none pb-0",children:[e.jsx(I,{color:"hsl(var(--chart-teal))",children:"Click rate"}),e.jsx(M,{value:C(t.clickedRate)})]})})]}),!i&&e.jsx(D,{}),e.jsx("div",{className:"mx-auto my-6 h-[240px]",children:e.jsx(ye,{className:"pointer-events-none aspect-square h-[240px]",config:n,data:g,tooltip:!1})})]}),e.jsxs("div",{className:`${i&&"pl-6"}`,children:[!i&&e.jsx(D,{}),e.jsxs("div",{className:i?"":"pt-3",children:[e.jsxs("div",{className:`flex items-center justify-between gap-3 ${i?"pb-3":"py-3"}`,children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Top clicked links in this email"}),e.jsx(J,{children:"Members"})]}),u.length>0?e.jsx(pe,{className:"",children:e.jsx(he,{children:u.slice(0,i?10:5).map(l=>{const r=t.clicked>0?l.count/t.clicked:0;return e.jsxs(xe,{children:[e.jsx(ue,{style:{width:`${r?Math.round(r*100):0}%`}}),e.jsx(ge,{children:e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(re,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),e.jsx("a",{className:"block truncate font-medium hover:underline",href:l.link.to,rel:"noreferrer",target:"_blank",title:l.link.to,children:we(l.link.to,!0)})]})}),e.jsxs(je,{children:[e.jsx(fe,{children:f(l.count||0)}),e.jsx(ve,{children:C(r)})]})]},l.link.link_id)})})}):e.jsx("div",{className:"py-20 text-center text-sm text-gray-700",children:"You have no links in your post."})]})]})]})]})},Ve=({chartData:o,range:c,isLoading:x,visitors:s,sourcesData:a,isNewsletterShown:t=!0})=>{const{postId:m}=Y(),u=A(),{data:g}=X(),n=g?.url,i=g?.icon,l=h.useMemo(()=>a?a.reduce((r,p)=>r+Number(p.visits||0),0):0,[a]);return e.jsx(e.Fragment,{children:e.jsxs(E,{className:`group/datalist overflow-hidden ${!t&&"col-span-2"}`,"data-testid":"web-performance",children:[e.jsxs("div",{className:"relative flex items-center justify-between gap-6",children:[e.jsx(K,{children:e.jsxs(O,{className:"flex items-center gap-1.5 text-lg",children:[e.jsx(F,{size:16,strokeWidth:1.5}),"Web performance"]})}),e.jsx(P,{className:"absolute right-6 translate-x-10 opacity-0 transition-all duration-300 group-hover/datalist:translate-x-0 group-hover/datalist:opacity-100",size:"sm",variant:"outline",onClick:()=>{u(`/posts/analytics/${m}/web`)},children:"View more"})]}),e.jsxs(y,{children:[e.jsxs("div",{children:[e.jsx(R,{className:"group relative flex grow flex-row items-start justify-between gap-5 border-none px-0 pt-0","data-testid":"unique-visitors",children:e.jsxs("div",{className:"flex grow flex-col gap-1.5 border-none pb-0",children:[e.jsx(I,{color:"hsl(var(--chart-blue))",children:"Unique visitors"}),e.jsx(M,{value:f(s)})]})}),e.jsx(D,{}),e.jsx("div",{className:"max-h-[288px] py-6 [&_.recharts-cartesian-axis-tick-value]:fill-gray-500",children:x?e.jsx("div",{className:"flex h-[16vw] min-h-[240px] items-center justify-center",children:e.jsx(V,{})}):e.jsx(De,{className:"aspect-auto h-[240px] w-full",color:"hsl(var(--chart-blue))",data:o||[],id:"visitors",range:c,syncId:"overview-charts"})})]}),t&&e.jsxs("div",{className:t?"border-t pt-3":"-mt-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between gap-3 py-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"How readers found this post"}),e.jsx(J,{children:"Visitors"})]})}),a&&a.length>0?e.jsx(Se,{data:a,range:c,siteIcon:i,siteUrl:n,tableOnly:!0,topSourcesLimit:5,totalVisitors:l}):e.jsx(Te,{className:"h-full py-10",description:"Once someone visits this post, sources will show here",title:"No visitors since you published this post",children:e.jsx(F,{strokeWidth:1.5})})]})]})]})})},ks=()=>{const o=A(),{statsConfig:c,isLoading:x,post:s,isPostLoading:a,postId:t}=X(),{totals:m,isLoading:u,currencySymbol:g}=ce(t),{appSettings:n}=ie(),{emailTrackClicks:i,emailTrackOpens:l}=n?.analytics||{},r=h.useMemo(()=>s?.published_at?le(s.published_at):Re.ALL_TIME.value,[s?.published_at]),{startDate:p,endDate:z,timezone:$}=oe(r),W=h.useMemo(()=>{const d={site_uuid:c?.id||"",date_from:U(p),date_to:U(z),timezone:$,post_uuid:""};return!a&&s?.uuid?{...d,post_uuid:s.uuid}:d},[a,s,c?.id,p,z,$]),{data:v,loading:G}=Q({endpoint:"api_kpis",statsConfig:c||{id:""},params:W}),Z=h.useMemo(()=>v?.length?v.reduce((d,j)=>{const H=Number(j.visits);return d+(isNaN(H)?0:H)},0):0,[v]),b=_e.visits,ee=ne(v||[],r,b.dataKey,"sum")?.map(d=>{const j=Number(d[b.dataKey]);return{date:String(d.date),value:j,formattedValue:b.formatter(j),label:b.label}}),{data:se,loading:ae}=Q({endpoint:"api_top_sources",statsConfig:c||{id:""},params:W}),B=x||u||a||G,te=a||x||G,w=Ie(s)&&l&&i,k=!s?.email_only&&n?.analytics.webAnalytics,N=n?.analytics.membersTrackSources;return h.useEffect(()=>{!a&&s&&Me(s)&&!n?.analytics.webAnalytics&&N&&o(`/posts/analytics/${t}/growth`,{replace:!0})},[a,s,n?.analytics.webAnalytics,o,t,N]),a?e.jsx(V,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{currentTab:"Overview"}),e.jsx(Le,{children:e.jsxs("div",{className:"flex flex-col gap-6 lg:grid lg:grid-cols-2",children:[k&&e.jsx(Ve,{chartData:ee,isLoading:te||B||ae,isNewsletterShown:w,range:r,sourcesData:se,visitors:Z}),w&&e.jsx(Pe,{isNewsletterStatsLoading:a,isWebShown:k,post:s}),N&&e.jsxs(E,{className:"group col-span-2 overflow-hidden p-0","data-testid":"growth",children:[e.jsxs("div",{className:"relative flex items-center justify-between gap-6",children:[e.jsx(K,{children:e.jsxs(O,{className:"flex items-center gap-1.5 text-lg",children:[e.jsx(Ae,{size:16,strokeWidth:1.5}),"Growth"]})}),e.jsx(P,{className:"absolute right-6 translate-x-10 opacity-0 transition-all duration-200 group-hover:translate-x-0 group-hover:opacity-100",size:"sm",variant:"outline",onClick:()=>{o(`/posts/analytics/${t}/growth`)},children:"View more"})]}),e.jsx(y,{className:"flex flex-col gap-6 px-0 md:grid md:grid-cols-3 md:items-stretch md:gap-0",children:B?Array.from({length:3},(d,j)=>e.jsxs("div",{className:"h-[98px] gap-1 border-r px-6 py-5 last:border-r-0",children:[e.jsx(q,{className:"w-2/3"}),e.jsx(q,{className:"h-7 w-12"})]},j)):e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"grow gap-1 py-0",children:[e.jsx(S,{children:"Free members"}),e.jsx(_,{children:e.jsx(T,{className:"text-[2.2rem]",children:f(m?.free_members||0)})})]}),n?.paidMembersEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"grow gap-1 py-0",children:[e.jsx(S,{children:"Paid members"}),e.jsx(_,{children:e.jsx(T,{className:"text-[2.2rem]",children:f(m?.paid_members||0)})})]}),e.jsxs(L,{className:"grow gap-1 py-0",children:[e.jsx(S,{children:"MRR impact"}),e.jsx(_,{children:e.jsxs(T,{className:"text-[2.2rem]",children:[g,f(de(m?.mrr||0))]})})]})]})]})})]}),!k&&!w&&!N&&e.jsx(me,{className:"col-span-2 py-20"})]})})]})};export{ks as default};
