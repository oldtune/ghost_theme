import{r as l,j as e,y as d,bI as I,C as W,aP as z,aU as U,bJ as V,aj as F,B as k,bE as H,ap as J,bK as K,bF as Y,bL as D,bG as g,x as q,bM as Q,bN as X,bO as j,bP as w,aT as Z,a0 as ee,a1 as se,a2 as ae,a3 as te,a4 as re,a5 as ie,a6 as le,a7 as ne}from"./index-Bgo4hw-T.js";import{h as oe,N as ce,P as de,i as u}from"./pagemenu-D3ByoZIR.js";import{P as me}from"./post-share-modal-Dz4BNSV-.js";import{u as ue}from"./post-analytics-context-BQ8IcW4n.js";import{i as C,h as pe,a as xe,b as he}from"./post-helpers-gInwAwEv.js";import{a as be}from"./posts-C94RiQ4S.js";import{S as fe,P as ge,G as je,M as we}from"./wallet-cards-Cl4bJBBw.js";import{T as ye}from"./trash-BKeiM6WP.js";import{S as ve}from"./sprout-CXg43Zav.js";const P=l.forwardRef(({...r},t)=>e.jsx("nav",{ref:t,"aria-label":"breadcrumb",...r}));P.displayName="Breadcrumb";const S=l.forwardRef(({className:r,...t},a)=>e.jsx("ol",{ref:a,className:d("flex flex-wrap items-center gap-1.5 break-words text-sm font-medium text-muted-foreground sm:gap-2.5 h-[34px]",r),...t}));S.displayName="BreadcrumbList";const p=l.forwardRef(({className:r,...t},a)=>e.jsx("li",{ref:a,className:d("inline-flex items-center gap-1.5",r),...t}));p.displayName="BreadcrumbItem";const y=l.forwardRef(({asChild:r,className:t,...a},x)=>{const i=r?I:"a";return e.jsx(i,{ref:x,className:d("inline-flex items-center gap-1 transition-colors hover:text-foreground",t),...a})});y.displayName="BreadcrumbLink";const T=l.forwardRef(({className:r,...t},a)=>e.jsx("span",{ref:a,"aria-current":"page","aria-disabled":"true",className:d("font-medium text-foreground",r),role:"link",...t}));T.displayName="BreadcrumbPage";const B=({children:r,className:t,...a})=>e.jsx("li",{"aria-hidden":"true",className:d("[&>svg]:w-3.5 [&>svg]:h-3.5",t),role:"presentation",...a,children:r??e.jsx(W,{})});B.displayName="BreadcrumbSeparator";const Me=({children:r,className:t,...a})=>e.jsx("section",{className:d("flex gap-6 flex-col py-8 size-full grow",t),...a,children:r}),Ne=r=>{for(const t of r)if(t.key==="timezone"){const a=t.value;if(typeof a!="string")throw new TypeError("Site timezone setting is not a string");return a}return"Etc/UTC"},Oe=({currentTab:r,children:t})=>{const a=z(),{fromAnalytics:x,appSettings:i}=U(),{mutateAsync:E}=be(),_=V(),[M,h]=l.useState(!1),[O,b]=l.useState(!1),{settings:$,site:v,statsConfig:L,post:s,isPostLoading:f,postId:o}=ue(),c=Ne($),{activeVisitors:N,isLoading:A}=oe({postUuid:s?.uuid,statsConfig:L,enabled:i?.analytics?.webAnalytics??!1}),m=l.useMemo(()=>{if(!s)return[];const n=[];return C(s)&&!i?.analytics.webAnalytics||(n.push("Overview"),!s.email_only&&i?.analytics.webAnalytics&&n.push("Web")),pe(s)&&n.push("Newsletter"),i?.analytics.membersTrackSources&&n.push("Growth"),n},[s,i?.analytics.webAnalytics,i?.analytics.membersTrackSources]),G=()=>{s&&h(!0)},R=async()=>{if(s)try{await E(o),h(!1),a("/posts/",{crossApp:!0})}catch(n){_(n)}};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"z-50 -mx-8 bg-white/70 backdrop-blur-md dark:bg-black",children:e.jsx("div",{className:"relative flex min-h-[102px] w-full items-start justify-between gap-5 px-8 pb-0 pt-8","data-header":"header",children:e.jsxs("div",{className:"flex w-full flex-col gap-5",children:[e.jsxs("div",{className:"flex w-full flex-col justify-between md:flex-row md:items-center",children:[e.jsx(P,{children:e.jsxs(S,{children:[x?e.jsx(p,{children:e.jsx(y,{className:"cursor-pointer leading-[24px]",onClick:()=>a("/analytics/",{crossApp:!0}),children:"Analytics"})}):e.jsx(p,{children:e.jsx(y,{className:"cursor-pointer leading-[24px]",onClick:()=>a("/posts/",{crossApp:!0}),children:"Posts"})}),e.jsx(B,{}),e.jsx(p,{children:e.jsx(T,{className:"leading-[24px]",children:"Post analytics"})})]})}),e.jsxs("div",{className:"flex w-full items-center gap-2 md:w-auto",children:[i?.analytics.webAnalytics&&!s?.email_only&&e.jsx("div",{className:"mr-3 flex grow items-center gap-2 text-sm md:grow-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",title:"Active readers in the last 5 minutes Â· Updates every 60 seconds",children:[e.jsxs("span",{className:"text-sm",children:[A?"":F(N)," reading now"]}),e.jsx("div",{className:`size-2 rounded-full ${A?"animate-pulse bg-muted":N?"bg-green-500":"border border-muted-foreground"}`})]})}),!f&&e.jsxs(e.Fragment,{children:[!s?.email_only&&e.jsx(me,{author:s?.authors?.[0]?.name||"",description:"",faviconURL:v?.icon||"",featureImageURL:s?.feature_image,open:O,postExcerpt:s?.excerpt||"",postTitle:s?.title,postURL:s?.url,siteTitle:v?.title||"",onClose:()=>b(!1),onOpenChange:b,children:e.jsxs(k,{variant:"outline",onClick:()=>b(!0),children:[e.jsx(fe,{})," Share"]})}),e.jsxs(H,{children:[e.jsx(J,{asChild:!0,children:e.jsx(k,{variant:"outline",children:e.jsx(K,{})})}),e.jsxs(Y,{align:"end",children:[e.jsxs(D,{children:[e.jsx(g,{asChild:!0,children:e.jsxs("a",{href:s?.url,rel:"noopener noreferrer",target:"_blank",children:[e.jsx(q,{}),"View in browser"]})}),e.jsxs(g,{onClick:()=>{a(`/editor/post/${o}`,{crossApp:!0})},children:[e.jsx(ge,{}),"Edit post"]})]}),e.jsx(Q,{}),e.jsx(D,{children:e.jsxs(g,{className:"text-destructive focus:text-destructive",onClick:G,children:[e.jsx(ye,{}),"Delete post"]})})]})]})]})]})]}),!f&&e.jsxs("div",{className:"flex items-start gap-6 md:items-center",children:[s?.feature_image&&e.jsx("div",{className:"aspect-[16/10] w-full max-w-[100px] rounded-md bg-cover bg-center md:max-w-[132px]",style:{backgroundImage:`url(${s.feature_image})`}}),e.jsxs("div",{children:[e.jsx(X,{className:"-ml-px max-w-[920px] indent-0 text-xl md:min-h-[35px] md:text-3xl md:leading-[1.2em]","data-header":"header-title",children:s?.title}),s?.published_at&&e.jsxs("div",{className:"mt-0.5 flex items-center justify-start text-sm leading-[1.65em] text-muted-foreground",children:[xe(s)&&`Sent on ${j(s.published_at,c)} at ${w(s.published_at,c)}`,C(s)&&`Published on your site on ${j(s.published_at,c)} at ${w(s.published_at,c)}`,he(s)&&`Published and sent on ${j(s.published_at,c)} at ${w(s.published_at,c)}`]})]})]})]})})}),e.jsxs(ce,{className:"sticky top-0 z-50 -mb-8 transform-gpu flex-col items-start gap-y-0 border-none bg-white/70 py-8 backdrop-blur-md lg:flex-row lg:items-center dark:bg-black",children:[!f&&e.jsxs(de,{className:"min-h-[34px]",defaultValue:r,responsive:!0,children:[m.includes("Overview")&&e.jsxs(u,{value:"Overview",onClick:()=>{a(`/posts/analytics/${o}`)},children:[e.jsx(je,{}),"Overview"]}),m.includes("Web")&&e.jsxs(u,{value:"Web",onClick:()=>{a(`/posts/analytics/${o}/web`)},children:[e.jsx(Z,{}),"Web traffic"]}),m.includes("Newsletter")&&e.jsxs(u,{value:"Newsletter",onClick:()=>{a(`/posts/analytics/${o}/newsletter`)},children:[e.jsx(we,{}),"Newsletter"]}),m.includes("Growth")&&e.jsxs(u,{value:"Growth",onClick:()=>{a(`/posts/analytics/${o}/growth`)},children:[e.jsx(ve,{}),"Growth"]})]}),t]}),e.jsx(ee,{open:M,onOpenChange:h,children:e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Are you sure you want to delete this post?"}),e.jsxs(re,{children:[`You're about to delete "`,e.jsx("strong",{children:s?.title}),'". This is permanent! We warned you, k?']})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Cancel"}),e.jsx(ne,{className:"hover:bg-red-700 bg-red-600 text-white",onClick:R,children:"Delete"})]})]})})]})};export{Oe as P,Me as a};
