const D={Reddit:"reddit.com","www.reddit.com":"reddit.com",Facebook:"facebook.com",Twitter:"twitter.com",Bluesky:"bsky.app","go.bsky.app":"bsky.app",Instagram:"instagram.com",LinkedIn:"linkedin.com",Threads:"threads.net","Brave Search":"search.brave.com",Ecosia:"ecosia.org",Gmail:"gmail.com",Outlook:"outlook.com","Yahoo!":"yahoo.com","AOL Mail":"aol.com",Flipboard:"flipboard.com",Substack:"substack.com",Ghost:"ghost.org","Ghost Explore":"ghost.org",Buffer:"buffer.com",Taboola:"taboola.com",AppNexus:"appnexus.com",Wikipedia:"wikipedia.org",Mastodon:"mastodon.social",Memeorandum:"memeorandum.com","Ground News":"ground.news","Apple News":"apple.com",SmartNews:"smartnews.com","Hacker News":"news.ycombinator.com",Google:"google.com","Google News":"news.google.com",Bing:"bing.com",DuckDuckGo:"duckduckgo.com","newsletter-email":"static.ghost.org",newsletter:"static.ghost.org"},b=e=>{try{return new URL(e.startsWith("http")?e:`https://${e}`).hostname.replace(/^www\./,"")}catch{return null}};function k({processedData:e,totalVisitors:s,mode:a}){return a==="growth"?e:e.map(n=>({...n,percentage:s>0?n.visits/s:0}))}const g=(e,s)=>e===s?!0:e.endsWith(`.${s}`),_=(e,s)=>{if(!e||typeof e!="string")return{domain:null,isDirectTraffic:!1};if(e==="Direct")return{domain:null,isDirectTraffic:!0};const a=s?b(s):null;if(a){const c=b(e);if(c&&g(c,a))return{domain:a,isDirectTraffic:!0};if(g(e,a))return{domain:a,isDirectTraffic:!0}}const n=D[e];return n?{domain:n,isDirectTraffic:!1}:/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)?{domain:e.replace(/^www\./,""),isDirectTraffic:!1}:{domain:null,isDirectTraffic:!1}};function T({data:e,mode:s,siteUrl:a,siteIcon:n,defaultSourceIconUrl:l}){if(!e)return[];const c=new Map;let p=s==="visits"?0:void 0;const i=s==="growth"?{free_members:0,paid_members:0,mrr:0}:void 0;if(e.forEach(r=>{const{domain:t,isDirectTraffic:u}=_(r.source,a),f=Number(r.visits||0);if(u||!r.source||r.source==="")s==="visits"?p+=f:s==="growth"&&i&&(i.free_members+=r.free_members||0,i.paid_members+=r.paid_members||0,i.mrr+=r.mrr||0);else{const m=String(r.source),w=t?`https://www.faviconextractor.com/favicon/${t}?larger=true`:l,h=t?`https://${t}`:void 0;if(c.has(m)){const o=c.get(m);o.visits+=f,s==="growth"&&(o.free_members=(o.free_members||0)+(r.free_members||0),o.paid_members=(o.paid_members||0)+(r.paid_members||0),o.mrr=(o.mrr||0)+(r.mrr||0))}else{const o={source:m,visits:f,isDirectTraffic:!1,iconSrc:w,displayName:m,linkUrl:h};s==="growth"&&(o.free_members=r.free_members||0,o.paid_members=r.paid_members||0,o.mrr=r.mrr||0),c.set(m,o)}}}),s==="visits"?p>0:i&&(i.free_members>0||i.paid_members>0||i.mrr>0)){const r={source:"Direct",visits:s==="visits"?p:0,isDirectTraffic:!0,iconSrc:n||l,displayName:"Direct",linkUrl:void 0};s==="growth"&&i&&(r.free_members=i.free_members,r.paid_members=i.paid_members,r.mrr=i.mrr),c.set("Direct",r)}const d=Array.from(c.values());return s==="growth"?d.sort((r,t)=>{const u=(r.mrr||0)*100+(r.paid_members||0)*10+(r.free_members||0);return(t.mrr||0)*100+(t.paid_members||0)*10+(t.free_members||0)-u}):d.sort((r,t)=>t.visits-r.visits)}export{k as e,_ as g,T as p};
