import{bV as v,cB as g,cG as j,r as w,j as s,cH as u,aP as y,ck as k,bW as N,bN as Y,aT as p,aj as D,y as M,aQ as S}from"./index-Bgo4hw-T.js";import{S as C,a as L,b as A,c as V,d as z,e as E,f as I}from"./select-MVpx-Kfp.js";import{a as O}from"./message-square-text-DzuHB7uU.js";import{h as G,N as W,k as P,P as R,i as f}from"./pagemenu-D3ByoZIR.js";import{G as $,M as B}from"./wallet-cards-Cl4bJBBw.js";import{S as T}from"./sprout-CXg43Zav.js";import{m as _}from"./lucide-react-7D_Tsesk.js";const oe=({excludeRanges:e=[]})=>{const{range:t,setRange:a}=v(),n=e.map(r=>g[r].value),l=j.filter(r=>!n.includes(r.value));return w.useEffect(()=>{if(n.includes(t)&&l.length>0){const r=l.find(i=>i.value===g.last7Days.value),c=r?r.value:l[0].value;a(c)}},[t,n,l,a]),s.jsxs(C,{value:`${t}`,onValueChange:r=>{a(Number(r))},children:[s.jsxs(L,{className:"w-auto",children:[s.jsx(O,{className:"mr-2",size:16,strokeWidth:1.5}),s.jsx(A,{placeholder:"Select a period"})]}),s.jsx(V,{align:"end",children:s.jsxs(z,{children:[s.jsx(E,{children:"Period"}),l.map(r=>s.jsx(I,{value:`${r.value}`,children:r.name},r.value))]})})]})},ue=e=>{const t=j.find(a=>a.value===e);return t?["Last 7 days","Last 30 days","Last 90 days","Last 12 months"].includes(t.name)?`in the ${t.name.toLowerCase()}`:t.name==="All time"?"(all time)":t.name.toLowerCase():""};function me(e){const t=e.findIndex(a=>Number(a.value)>0);return t>1?e.slice(t-1):e}function H(e,t){return u(t).diff(u(e),"days")}function U(e,t){return u(e).isSame(u(t),"month")}function F(e,t){return u(e).isSame(u(t),"week")}function x(e,t,a,n){switch(n){case"sum":return e;case"avg":return t>0?e/t:0;case"exact":return a}}function Q(e){const t=[...e].sort((r,c)=>r-c),a=t[Math.floor(t.length/2)],n=e.map(r=>Math.abs(r-a)),l=n.sort((r,c)=>r-c)[Math.floor(n.length/2)];return{threshold:a+5*l,average:a}}function q(e,t,a,n){return n||(e===-1&&(t>150?e=400:t>60&&(e=100)),a==="exact"&&(e>356||e===-1&&t>150)?"monthly":e>=91&&e<=356||e===-1&&t>60&&t<=150?"weekly":e>356||e===-1&&t>150?"monthly":"none")}function J(e,t){if(e.length<=1)return e;const a=e.map(r=>Number(r[t])),{threshold:n,average:l}=Q(a);return e.map(r=>{const c=Number(r[t]);return{...r,_isOutlier:c>n||c>l*10}})}function K(e,t,a){const n=[];let l=u(e[0].date).startOf("week"),r=0,c=0,i=0;return e.forEach((o,m)=>{const h=u(o.date);F(h.format("YYYY-MM-DD"),l.format("YYYY-MM-DD"))?(r+=Number(o[t]),c+=1,i=Number(o[t])):(n.push({...e[m-1],date:l.format("YYYY-MM-DD"),[t]:x(r,c,i,a)}),l=h.startOf("week"),r=Number(o[t]),c=1,i=Number(o[t])),m===e.length-1&&n.push({...o,date:l.format("YYYY-MM-DD"),[t]:x(r,c,i,a)})}),n}function X(e,t,a){const n=[];let l=u(e[0].date).startOf("month"),r=0,c=0,i=0,o=null;return e.forEach((m,h)=>{const b=u(m.date),d=Number(m[t]);U(b.format("YYYY-MM-DD"),l.format("YYYY-MM-DD"))?(r+=d,c+=1,i=d,o=m):(a==="exact"&&o?n.push({...o,[t]:i}):n.push({...e[h-1],date:l.format("YYYY-MM-DD"),[t]:x(r,c,i,a)}),l=b.startOf("month"),r=d,c=1,i=d,o=m),h===e.length-1&&(a==="exact"&&o?n.push({...o,[t]:i}):n.push({...m,date:l.format("YYYY-MM-DD"),[t]:x(r,c,i,a)}))}),n}const he=(e,t,a="value",n="avg",l)=>{if(!e.length)return[];const r=e.length>1?H(e[0].date,e[e.length-1].date):0,c=q(t,r,n,l);let i;switch(c){case"weekly":i=K(e,a,n);break;case"monthly":i=X(e,a,n);break;default:i=e}return J(i,a)},de=({children:e})=>{const t=y(),a=k(),{appSettings:n}=N(),{site:l,statsConfig:r}=v(),{activeVisitors:c,isLoading:i}=G({statsConfig:r,enabled:n?.analytics?.webAnalytics??!1}),o=a.pathname.endsWith("/")?a.pathname:`${a.pathname}/`;return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"z-40 -mx-8 bg-white/70 backdrop-blur-md dark:bg-black",children:s.jsxs("div",{className:"relative flex w-full items-center justify-between gap-5 px-8 pb-0 pt-8","data-header":"header",children:[s.jsx(Y,{className:"-ml-px min-h-[35px] max-w-[920px] indent-0 leading-[1.2em]","data-header":"header-title",children:"Analytics"}),n?.analytics.webAnalytics&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l?.url&&s.jsxs("div",{className:"hidden items-center gap-1.5 sm:!visible sm:!flex",children:[s.jsx(p,{className:"text-muted-foreground",size:16,strokeWidth:1.5}),s.jsx("a",{className:"text-sm font-medium transition-all hover:opacity-75 dark:text-gray-100",href:l.url,rel:"noopener noreferrer",target:"_blank",title:`Visit ${new URL(l.url).hostname}`,children:new URL(l.url).hostname}),s.jsx("span",{className:"text-border",children:"|"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",title:"Active visitors in the last 5 minutes Â· Updates every 60 seconds",children:[s.jsxs("span",{className:"text-sm",children:[i?"":D(c)," online"]}),s.jsx("div",{className:`size-2 rounded-full ${i?"animate-pulse bg-muted":c?"bg-green-500":"border border-muted-foreground"}`})]})]})]})}),s.jsxs(W,{className:"sticky top-0 z-40 transform-gpu flex-col items-start gap-y-0 border-none bg-white/70 pb-6 pt-9 backdrop-blur-md lg:flex-row lg:items-center dark:bg-black",children:[s.jsx(P,{children:s.jsxs(R,{defaultValue:o,responsive:!0,children:[s.jsxs(f,{value:"/analytics/",onClick:()=>{t("/analytics/")},children:[s.jsx($,{}),"Overview"]}),n?.analytics.webAnalytics&&s.jsxs(f,{value:"/analytics/web/",onClick:()=>{t("/analytics/web/")},children:[s.jsx(p,{}),"Web traffic"]}),n?.newslettersEnabled&&s.jsxs(f,{value:"/analytics/newsletters/",onClick:()=>{t("/analytics/newsletters/")},children:[s.jsx(B,{}),"Newsletters"]}),s.jsxs(f,{value:"/analytics/growth/",onClick:()=>{t("/analytics/growth/")},children:[s.jsx(T,{}),"Growth"]})]})}),e]})]})},Z=({children:e,...t})=>s.jsx("div",{className:"size-full",children:s.jsx("div",{className:"relative size-full",...t,children:s.jsx("div",{className:"mx-auto flex size-full max-w-page flex-col",children:e})})}),fe=({children:e})=>s.jsx(Z,{children:s.jsx("div",{className:"grid w-full grow",children:s.jsx("div",{className:"flex h-full flex-col px-8",children:e})})}),ee=()=>s.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-4 text-gray-700",children:[s.jsx("div",{className:"-mt-10 flex size-18 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-950",children:s.jsx(_,{size:24,strokeWidth:1.5})}),"No stats available for this filter."]}),te=({children:e,className:t,...a})=>s.jsx("section",{className:M("flex grow flex-col items-stretch gap-6 w-full pb-8",t),...a,children:e}),xe=({isLoading:e,data:t,children:a,loadingComponent:n=s.jsx(S,{}),emptyComponent:l=s.jsx(ee,{})})=>s.jsx(te,{children:e?n:t!==void 0&&t&&t.length===0?l:a});export{oe as D,fe as S,de as a,xe as b,q as d,ue as g,he as s,me as t};
