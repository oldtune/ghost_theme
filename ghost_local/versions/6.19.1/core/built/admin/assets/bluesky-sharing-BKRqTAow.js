import{m as E,r,W as F,Y as H,Z as z,V as c,j as e,L as p,O as y,f as h,B as i,D as I,q as M,t as S,v as O,w as T,A as L,_ as R,$ as U,x as P,a0 as _,a1 as Y,a2 as W,a3 as V,a4 as Z,a5 as $,a6 as q,a7 as X,a8 as G}from"./index-Bgo4hw-T.js";import{E as J}from"./edit-profile-B_ViIhsd.js";import{C as K}from"./copy-CTHgI4YI.js";import"./label-BQ5mfFHN.js";import"./at-sign-V79EBNTJ.js";const Q=5e3,ee=12,ne=()=>{const{data:s,isLoading:j}=E("index","me"),[n,a]=r.useState(()=>s?.blueskyEnabled&&!s?.blueskyHandleConfirmed),[b,x]=r.useState(!1),[v,d]=r.useState(!1),[k,u]=r.useState(!1),[w,o]=r.useState(!1),l=r.useRef(0),C=F("index"),m=H("index"),N=z("index"),B=async()=>{x(!0),await navigator.clipboard.writeText(s?.blueskyHandle||""),setTimeout(()=>x(!1),2e3)},A=async()=>{if(!s?.avatarUrl)d(!0);else{a(!0);try{await C.mutateAsync()}catch{a(!1),c.error("Something went wrong, please try again.")}}},D=async()=>{a(!0);try{await m.mutateAsync(),u(!1),c.success("Bluesky sharing disabled")}finally{a(!1)}},g=r.useCallback(()=>{N.mutateAsync().then(t=>{t&&o(!0)})},[]);if(r.useEffect(()=>{if(!s?.blueskyEnabled){o(!1),a(!1),l.current=0;return}if(s?.blueskyHandleConfirmed){o(!0),a(!1),l.current>0&&c.success("Bluesky sharing enabled"),l.current=0;return}o(!1),a(!0),l.current=0;const t=setInterval(async()=>{if(l.current+=1,l.current>ee){clearInterval(t),c.error("Something went wrong, please try again."),await m.mutateAsync(),a(!1);return}g()},Q);return()=>clearInterval(t)},[s?.blueskyEnabled,s?.blueskyHandleConfirmed,g]),j)return e.jsx(p,{children:e.jsxs("div",{className:"mx-auto max-w-[620px] py-[min(4vh,48px)]",children:[e.jsx("div",{className:"flex items-center justify-between gap-8",children:e.jsx(y,{children:"Bluesky sharing"})}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(h,{size:"md"})})]})});const f=s?.blueskyEnabled&&s?.blueskyHandleConfirmed;return e.jsxs(p,{children:[e.jsxs("div",{className:"mx-auto max-w-[620px] py-[min(4vh,48px)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8",children:[e.jsx(y,{children:"Bluesky sharing"}),f&&e.jsxs(i,{className:"group w-24 translate-y-1 px-2 hover:!bg-red/5 hover:text-red",size:"default",variant:"outline",onClick:()=>u(!0),children:[e.jsx("span",{className:"size-2 rounded-full bg-green group-hover:hidden"}),e.jsx("span",{className:"group-hover:hidden",children:"Enabled"}),e.jsx("span",{className:"hidden group-hover:!visible group-hover:!inline",children:"Disable"})]})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mt-2 pr-32 text-base",children:["Your social web profile is now connected to Bluesky, via ",e.jsx("a",{className:"text-purple hover:text-purple-600",href:"https://fed.brid.gy",rel:"noreferrer",target:"_blank",children:"Bridgy Fed"}),". Posts are automatically synced after a short delay to complete activation."]}),w&&e.jsxs("div",{className:"mt-6 flex flex-col items-center gap-4 rounded-lg border border-gray-200 p-8 dark:border-gray-950",children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{author:{icon:{url:s?.avatarUrl||""},name:s?.name||"",handle:s?.handle||""},size:"md"}),e.jsx("div",{className:"absolute bottom-0 right-0 z-10 flex size-6 items-center justify-center rounded-full bg-white shadow-xs",children:e.jsx("svg",{height:"14",role:"img",viewBox:"0 0 24 24",width:"14",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 10.8c-1.087 -2.114 -4.046 -6.053 -6.798 -7.995C2.566 0.944 1.561 1.266 0.902 1.565 0.139 1.908 0 3.08 0 3.768c0 0.69 0.378 5.65 0.624 6.479 0.815 2.736 3.713 3.66 6.383 3.364 0.136 -0.02 0.275 -0.039 0.415 -0.056 -0.138 0.022 -0.276 0.04 -0.415 0.056 -3.912 0.58 -7.387 2.005 -2.83 7.078 5.013 5.19 6.87 -1.113 7.823 -4.308 0.953 3.195 2.05 9.271 7.733 4.308 4.267 -4.308 1.172 -6.498 -2.74 -7.078a8.741 8.741 0 0 1 -0.415 -0.056c0.14 0.017 0.279 0.036 0.415 0.056 2.67 0.297 5.568 -0.628 6.383 -3.364 0.246 -0.828 0.624 -5.79 0.624 -6.478 0 -0.69 -0.139 -1.861 -0.902 -2.206 -0.659 -0.298 -1.664 -0.62 -4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z",fill:"#0385FF",strokeWidth:"1"})})})]}),e.jsxs("div",{className:"flex grow flex-col items-center",children:[e.jsx(R,{children:s?.name||""}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-800",children:[e.jsx("span",{className:"text-lg font-medium",children:s?.blueskyHandle}),e.jsx(i,{className:"size-6 p-0 hover:opacity-80",title:"Copy handle",variant:"link",onClick:B,children:b?e.jsx(U,{size:16}):e.jsx(K,{size:16})})]})]}),e.jsx(i,{className:"mt-2 w-full",size:"lg",variant:"secondary",asChild:!0,children:e.jsxs("a",{href:`https://bsky.app/profile/${s?.blueskyHandle?.replace(/^@/,"")}`,rel:"noreferrer",target:"_blank",children:["Open profile",e.jsx(P,{size:14,strokeWidth:1.25})]})})]})]}):e.jsxs("div",{className:"mt-3 flex flex-col gap-5",children:[e.jsx("p",{className:"text-base",children:s?.avatarUrl?e.jsxs(e.Fragment,{children:["Connect your account to ",e.jsx("a",{className:"text-purple hover:text-purple-600",href:"https://fed.brid.gy",rel:"noreferrer",target:"_blank",children:"Bridgy Fed"})," to share content directly to a dedicated Bluesky profile and increase your reach across the social web."]}):"Add a profile image to connect to Bluesky. Profile pictures help prevent spam."}),e.jsx("p",{className:"-mt-2 text-base",children:"You can't change your Bluesky username, so make sure you're happy with your current social web handle before connecting."}),s?.avatarUrl?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"h-10 text-base",disabled:n,variant:"secondary",onClick:A,children:n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"sm"}),e.jsx("span",{children:"Enabling Bluesky sharing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{height:"32",role:"img",viewBox:"0 0 24 24",width:"32",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 10.8c-1.087 -2.114 -4.046 -6.053 -6.798 -7.995C2.566 0.944 1.561 1.266 0.902 1.565 0.139 1.908 0 3.08 0 3.768c0 0.69 0.378 5.65 0.624 6.479 0.815 2.736 3.713 3.66 6.383 3.364 0.136 -0.02 0.275 -0.039 0.415 -0.056 -0.138 0.022 -0.276 0.04 -0.415 0.056 -3.912 0.58 -7.387 2.005 -2.83 7.078 5.013 5.19 6.87 -1.113 7.823 -4.308 0.953 3.195 2.05 9.271 7.733 4.308 4.267 -4.308 1.172 -6.498 -2.74 -7.078a8.741 8.741 0 0 1 -0.415 -0.056c0.14 0.017 0.279 0.036 0.415 0.056 2.67 0.297 5.568 -0.628 6.383 -3.364 0.246 -0.828 0.624 -5.79 0.624 -6.478 0 -0.69 -0.139 -1.861 -0.902 -2.206 -0.659 -0.298 -1.664 -0.62 -4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z",fill:"#0385FF",strokeWidth:"1"})}),"Enable Bluesky sharing"]})}),n&&e.jsx("p",{className:"-mt-2 text-center text-sm text-gray-700 dark:text-gray-600",children:"You can leave this page and come back to check the status."})]}):e.jsxs(I,{open:v,onOpenChange:d,children:[e.jsx(M,{children:e.jsx(i,{className:"h-10 w-full text-base",variant:"secondary",children:"Edit profile"})}),e.jsxs(S,{className:"w-full max-w-[520px]",onOpenAutoFocus:t=>t.preventDefault(),children:[e.jsx(O,{children:e.jsx(T,{children:"Profile settings"})}),s&&e.jsx(J,{account:s,setIsEditingProfile:d})]})]})]})]}),e.jsx(_,{open:k,onOpenChange:u,children:e.jsxs(Y,{children:[e.jsxs(W,{children:[e.jsx(V,{children:"Disable Bluesky sharing?"}),e.jsx(Z,{children:"Your bridged Bluesky account will be deactivated and your content will no longer be shared on Bluesky. You can re-enable sharing at any time."})]}),e.jsxs($,{children:[e.jsx(q,{children:"Cancel"}),e.jsx(X,{className:G({variant:"destructive"}),disabled:n,onClick:t=>{t.preventDefault(),D()},children:n?e.jsx(h,{color:"light",size:"sm"}):"Disable"})]})]})})]})};export{ne as default};
