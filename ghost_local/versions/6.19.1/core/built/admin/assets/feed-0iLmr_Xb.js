import{j as e,bd as v,A as k,r as i,b as N,be as R,H as F,B as g,bf as L,C as P,X as z,S as b,P as I,n as M,aR as y,L as B,F as E,i as W,f as U,E as A,c as $,bg as H,bh as D,bi as O,bj as Q,bk as V}from"./index-Bgo4hw-T.js";import{H as T}from"./hash-CRtHv162.js";const w=({user:l})=>e.jsx(v,{children:e.jsxs("div",{className:"relative my-5 w-full hover:cursor-pointer",children:[e.jsx("div",{className:"pointer-events-none absolute left-4 top-4",children:e.jsx(k,{author:l})}),e.jsx("div",{"aria-label":"New post",className:"text inset-0 flex h-[72px] w-full items-center justify-start rounded-lg bg-white pl-[68px] text-left text-[1.5rem] font-normal tracking-normal text-gray-500 shadow-[0_5px_24px_0px_rgba(0,0,0,0.02),0px_2px_5px_0px_rgba(0,0,0,0.07),0px_0px_1px_0px_rgba(0,0,0,0.25)] transition-all hover:bg-white hover:shadow-[0_5px_24px_0px_rgba(0,0,0,0.05),0px_14px_12px_-9px_rgba(0,0,0,0.07),0px_0px_1px_0px_rgba(0,0,0,0.25)] dark:border dark:border-gray-925 dark:bg-black dark:shadow-none dark:hover:border-gray-800 dark:hover:bg-black dark:hover:shadow-none",children:"What's new?"})]})}),X=()=>{const l=i.useRef(null),o=N(),[c,x]=i.useState(!1),[h,d]=i.useState(!0),{suggestedProfilesQuery:f,updateSuggestedProfile:r}=R("index",10),{data:n=[],isLoading:a}=f,u=()=>{const s=l.current;if(!s)return;const p=s.scrollLeft>0,j=s.scrollLeft<s.scrollWidth-s.clientWidth;x(p),d(j)};if(i.useEffect(()=>{u()},[n]),!a&&(!n||n.length<4))return null;const t=s=>{},m=s=>{r(s.id,{followedByMe:!0})},_=s=>{r(s.id,{followedByMe:!1})},C=()=>{const s=l.current;s&&s.scrollBy({left:-352,behavior:"smooth"})},S=()=>{const s=l.current;if(!s)return;s.scrollBy({left:176*2,behavior:"smooth"})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-7 pt-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx(F,{className:"text-lg font-semibold text-black dark:text-white",children:"More people to follow"}),e.jsx(g,{className:"px-0 font-medium text-gray-700 hover:text-black dark:text-gray-600 dark:hover:text-white",variant:"link",onClick:()=>o("/explore"),children:"Find more â†’"})]}),e.jsxs("div",{className:"relative",children:[c&&e.jsx(g,{className:"absolute -left-10 top-1/2 z-10 size-10 -translate-y-1/2 text-gray-700 hover:bg-transparent max-lg:hidden dark:text-gray-600 dark:hover:text-white",variant:"ghost",onClick:C,children:e.jsx(L,{className:"!size-6"})}),h&&e.jsx(g,{className:"absolute -right-10 top-1/2 z-10 size-10 -translate-y-1/2 text-gray-700 hover:bg-transparent max-lg:hidden dark:text-gray-600 dark:hover:text-white",variant:"ghost",onClick:S,children:e.jsx(P,{className:"!size-6"})}),e.jsx("div",{ref:l,className:"flex snap-x snap-mandatory gap-4 overflow-x-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none"},onScroll:u,children:(a?Array(10).fill(null):n||[]).map((s,p)=>e.jsxs("div",{className:"relative w-40 shrink-0 snap-start rounded-lg bg-gray-75 p-4 dark:bg-gray-925/30",onClick:!a&&s?()=>o(`/profile/${s.handle}`):void 0,children:[e.jsx(g,{className:"absolute right-2 top-1 hidden p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",variant:"link",onClick:j=>{j.stopPropagation(),t(s?.id||"")},children:e.jsx(z,{className:"size-4"})}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"mb-3",children:a?e.jsx(b,{className:"size-16 rounded-full"}):e.jsx(I,{actor:s,align:"center",children:e.jsx("div",{children:e.jsx(k,{author:{icon:{url:s?.avatarUrl||""},name:s?.name||"",handle:s?.handle||""},size:"md"})})})}),e.jsx("span",{className:"mb-6 w-full truncate font-semibold text-black dark:text-white",children:a?e.jsx(b,{className:"h-5 w-32"}):s?.name||""}),a?e.jsx(b,{className:"h-8 w-16"}):e.jsx(M,{following:s?.followedByMe||!1,handle:s?.handle||"",type:"primary",onFollow:()=>s&&m(s),onUnfollow:()=>s&&_(s)})]})]},s?.id||`loading-${p}`))})]})]}),e.jsx(y,{})]})},q=({isLoading:l,activities:o,user:c,fetchNextPage:x,hasNextPage:h,isFetchingNextPage:d})=>{const f=N(),r=i.useRef(null),n=i.useRef(null),a=i.useRef(null);i.useEffect(()=>(r.current&&r.current.disconnect(),r.current=new IntersectionObserver(t=>{t[0].isIntersecting&&h&&!d&&x()}),n.current&&r.current.observe(n.current),a.current&&r.current.observe(a.current),()=>{r.current&&r.current.disconnect()}),[h,d,x]);const u=Math.max(0,Math.floor(o.length*.75)-1);return e.jsx(B,{children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsx("div",{className:"w-full",children:o.length>0?e.jsx("div",{className:"my-4",children:e.jsx("div",{className:"mx-auto flex items-start gap-11",children:e.jsx("div",{className:"flex w-full min-w-0 flex-col items-center",children:e.jsxs("div",{className:"flex w-full min-w-0 max-w-[620px] flex-col items-start",children:[e.jsx(w,{user:c}),e.jsxs("ul",{className:"mx-auto flex w-full flex-col px-4 max-lg:px-0","data-testid":"feed-list",children:[o.map((t,m)=>e.jsxs("li",{"data-testid":"feed-item","data-test-view-article":!0,children:[e.jsx(E,{actor:t.actor,allowDelete:t.object.authored,commentCount:t.object.replyCount??0,isLoading:l,isPending:W(t.id),layout:"feed",likeCount:t.object.likeCount??0,object:t.object,repostCount:t.object.repostCount??0,type:t.type,onClick:()=>{f(`/notes/${encodeURIComponent(t.id)}`)}}),m<o.length-1&&e.jsx(y,{}),m===3&&e.jsx(X,{}),m===u&&e.jsx("div",{ref:n,className:"h-1"})]},`${t.id}-${t.type}-${m}`)),d&&e.jsx("li",{className:"flex flex-col items-center justify-center space-y-4 text-center",children:e.jsx(U,{size:"md"})})]}),e.jsx("div",{ref:a,className:"h-1"})]})})})}):e.jsx("div",{className:"flex w-full flex-col items-center gap-10",children:e.jsxs("div",{className:"mt-4 flex w-full max-w-[620px] flex-col items-center",children:[e.jsx(w,{user:c}),e.jsx("div",{className:"mt-[-128px]",children:e.jsxs(A,{children:[e.jsx($,{children:e.jsx(T,{})}),e.jsxs("div",{children:["The Feed is the stream of thoughts and ",e.jsx("span",{className:"text-black dark:text-white",children:"bite-sized updates"})," from people you follow in the Social Web. It's looking a little empty right now but once the people you follow start posting, their updates will show up here."]}),e.jsx(v,{children:e.jsxs(g,{className:"text-white dark:text-black",children:[e.jsx(H,{}),"Write your first note"]})})]})})]})})})})})},K=()=>{const{feedQuery:l}=D({enabled:!0}),{data:o,error:c,fetchNextPage:x,hasNextPage:h,isFetchingNextPage:d,isLoading:f}=l,r=o?.pages.flatMap(a=>a.posts)??Array.from({length:5},(a,u)=>({id:`placeholder-${u}`,object:{}})),{data:n}=O("index");return c&&Q(c)?e.jsx(V,{errorCode:c.code,statusCode:c.statusCode}):e.jsx(q,{activities:r,fetchNextPage:x,hasNextPage:h,isFetchingNextPage:d,isLoading:f,user:n})};export{K as default};
